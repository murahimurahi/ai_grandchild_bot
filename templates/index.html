<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãŠã¯ãªã—æ¨ªä¸</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <h1>ãŠã¯ãªã—æ¨ªä¸</h1>
    <p class="subtitle">ã‚„ã•ã—ãè©±ã›ã‚‹ã€ã‚ãŸãŸã‹ã„æ™‚é–“ã‚’ã©ã†ãã€‚</p>

    <div class="select-box">
      <label><input type="radio" name="speaker" value="ã¿ã•ã¡ã‚ƒã‚“" checked> ã¿ã•ã¡ã‚ƒã‚“ï¼ˆå­«å¨˜ï¼‰</label>
      <label><input type="radio" name="speaker" value="ã‚†ã†ãã‚“"> ã‚†ã†ãã‚“ï¼ˆå­«æ¯å­ï¼‰</label>
      <label><input type="radio" name="speaker" value="ã‚½ã‚¦ã‚¿"> ã‚½ã‚¦ã‚¿ï¼ˆæ¯å­ï¼‰</label>
    </div>

    <div class="howto">
      <p>â‘  æ€ã£ãŸã“ã¨ã‚’ä¸€è¨€ã¤ã¶ã‚„ãã€‚</p>
      <p>â‘¡ è©±ã—ã‹ã‘ã‚‹ã‚’æŠ¼ã™ã¨ã€AIãŒè¿”äº‹ã—ã¾ã™ã€‚</p>
      <p>â‘¢ éŸ³å£°å…¥åŠ›ã§ã‚‚OKã§ã™ã€‚</p>
    </div>

    <textarea id="userText" placeholder="ä¾‹ï¼‰ä»Šæ—¥ã¯å°‘ã—ç–²ã‚ŒãŸãªâ€¦"></textarea>
    <div class="btns">
      <button id="micBtn">ğŸ¤ éŸ³å£°å…¥åŠ›</button>
      <button id="talkBtn" class="talk">è©±ã—ã‹ã‘ã‚‹</button>
    </div>

    <div id="result"></div>
    <audio id="audio" controls hidden></audio>
  </div>

  <footer>Â© ãŠã¯ãªã—æ¨ªä¸</footer>

  <script>
    const talkBtn = document.getElementById("talkBtn");
    const micBtn = document.getElementById("micBtn");
    const userText = document.getElementById("userText");
    const result = document.getElementById("result");
    const audio = document.getElementById("audio");

    // --- éŸ³å£°å…¥åŠ› ---
    micBtn.addEventListener("click", () => {
      const rec = new webkitSpeechRecognition();
      rec.lang = "ja-JP";
      rec.start();
      rec.onresult = e => {
        userText.value = e.results[0][0].transcript;
      };
    });

    // --- è©±ã—ã‹ã‘ã‚‹ ---
    talkBtn.addEventListener("click", async () => {
      const text = userText.value.trim();
      const speaker = document.querySelector('input[name="speaker"]:checked').value;
      if (!text) return alert("ä½•ã‹è©±ã—ã‹ã‘ã¦ãã ã•ã„ã­ã€‚");

      result.innerText = "è€ƒãˆä¸­...";
      const res = await fetch("/talk", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({text, speaker})
      });
      const data = await res.json();
      if (data.reply) {
        result.innerText = data.reply;
        audio.src = data.audio;
        audio.hidden = false;
        audio.play();
      } else {
        result.innerText = "ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ãã ã•ã„ã€‚";
      }
    });
  </script>
</body>
</html>
