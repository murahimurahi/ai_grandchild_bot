<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãŠã¯ãªã—æ¨ªä¸</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <h1>ãŠã¯ãªã—æ¨ªä¸</h1>
    <p>ã‚„ã•ã—ãè©±ã›ã‚‹ã€ã‚ãŸãŸã‹ã„æ™‚é–“ã‚’ã©ã†ãã€‚</p>

    <form id="talkForm">
      <label><input type="radio" name="character" value="ã¿ã•ã¡ã‚ƒã‚“ï¼ˆå­«å¨˜ï¼‰" checked> ã¿ã•ã¡ã‚ƒã‚“ï¼ˆå­«å¨˜ï¼‰</label>
      <label><input type="radio" name="character" value="ã‚†ã†ãã‚“ï¼ˆå­«æ¯å­ï¼‰"> ã‚†ã†ãã‚“ï¼ˆå­«æ¯å­ï¼‰</label>
      <label><input type="radio" name="character" value="ã‚½ã‚¦ã‚¿ï¼ˆæ¯å­ï¼‰"> ã‚½ã‚¦ã‚¿ï¼ˆæ¯å­ï¼‰</label>

      <p>â‘  æ€ã£ãŸã“ã¨ã‚’ä¸€è¨€ã¤ã¶ã‚„ãã€‚</p>
      <p>â‘¡ ã€Œè©±ã—ã‹ã‘ã‚‹ã€ã¾ãŸã¯éŸ³å£°å…¥åŠ›ã§è©±ã›ã¾ã™ã€‚</p>
      <p>â‘¢ AIãŒã™ãã«ã‚„ã•ã—ãè¿”ã—ã¦ãã‚Œã¾ã™ã€‚</p>

      <textarea id="message" placeholder="ã“ã‚“ã«ã¡ã¯"></textarea><br>
      <button type="button" id="voiceBtn">ğŸ™ éŸ³å£°å…¥åŠ›</button>
      <button type="submit">è©±ã—ã‹ã‘ã‚‹</button>
    </form>

    <div id="response"></div>
  </div>

  <script>
  const form = document.getElementById('talkForm');
  const responseDiv = document.getElementById('response');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const message = document.getElementById('message').value;
    const character = document.querySelector('input[name="character"]:checked').value;
    responseDiv.innerHTML = "è€ƒãˆä¸­â€¦";

    const res = await fetch('/talk', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message, character })
    });
    const data = await res.json();

    responseDiv.innerHTML = `
      <p>${data.reply}</p>
      ${data.audio_url ? `<audio controls src="${data.audio_url}"></audio>` : ''}
    `;
  });

  // éŸ³å£°å…¥åŠ›
  const voiceBtn = document.getElementById('voiceBtn');
  voiceBtn.addEventListener('click', () => {
    const recognition = new webkitSpeechRecognition();
    recognition.lang = "ja-JP";
    recognition.start();
    recognition.onresult = (e) => {
      document.getElementById('message').value = e.results[0][0].transcript;
      form.requestSubmit(); // éŸ³å£°ã§å…¥åŠ›ã—ãŸã‚‰è‡ªå‹•é€ä¿¡
    };
  });
  </script>
</body>
</html>
